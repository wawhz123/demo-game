<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>21ç‚¹ - æ¸¸æˆå¤§å…</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      background: radial-gradient(circle at top, #e0f2fe 0, #bfdbfe 35%, #93c5fd 70%, #60a5fa 100%);
      color: #f9fafb;
      min-height: 100vh;
      padding: 16px;
    }

    .game-wrapper {
      max-width: 600px;
      margin: 0 auto;
    }

    .card {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      padding: 16px;
      box-shadow:
        0 18px 45px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(148, 163, 184, 0.18);
      backdrop-filter: blur(12px);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .title-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title {
      font-size: 20px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    .btn {
      appearance: none;
      border: none;
      outline: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.16s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #06b6d4);
      color: #f9fafb;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.45);
    }

    .btn-primary:active {
      transform: translateY(1px) scale(0.99);
    }

    .btn-back {
      background: rgba(15, 23, 42, 0.8);
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 6px 10px;
    }

    .btn-action {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: #f9fafb;
      padding: 12px 24px;
      font-size: 14px;
      margin: 4px;
      min-width: 100px;
    }

    .btn-action:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-action.green {
      background: linear-gradient(135deg, #10b981, #059669);
    }

    .score-panel {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    .score-box {
      flex: 1;
      background: rgba(15, 23, 42, 0.8);
      border-radius: 12px;
      padding: 12px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      text-align: center;
    }

    .score-label {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .score-value {
      font-size: 20px;
      font-weight: 700;
      color: #fbbf24;
    }

    .game-area {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(59, 130, 246, 0.1));
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .player-area {
      margin-bottom: 24px;
    }

    .player-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .player-name {
      font-size: 16px;
      font-weight: 600;
    }

    .player-points {
      font-size: 18px;
      font-weight: 700;
      color: #fbbf24;
    }

    .cards-container {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      min-height: 100px;
    }

    .card-item {
      width: 70px;
      height: 98px;
      background: linear-gradient(135deg, #f9fafb, #e5e7eb);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      color: #1f2937;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(0, 0, 0, 0.1);
      position: relative;
      animation: cardAppear 0.3s ease;
    }

    @keyframes cardAppear {
      from {
        transform: scale(0) rotate(180deg);
        opacity: 0;
      }
      to {
        transform: scale(1) rotate(0deg);
        opacity: 1;
      }
    }

    .card-item.red {
      color: #dc2626;
    }

    .card-item.black {
      color: #1f2937;
    }

    .card-item.hidden {
      background: linear-gradient(135deg, #1e40af, #1e3a8a);
      color: #f9fafb;
    }

    .card-item.hidden::before {
      content: '?';
      font-size: 32px;
    }

    .card-rank {
      font-size: 18px;
      font-weight: 700;
    }

    .card-suit {
      font-size: 24px;
    }

    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .status-info {
      text-align: center;
      padding: 12px;
      background: rgba(15, 23, 42, 0.8);
      border-radius: 8px;
      margin-bottom: 12px;
      font-size: 14px;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .status-info.win {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
    }

    .status-info.lose {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .game-over {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.98);
      border-radius: 12px;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .game-over.show {
      display: flex;
    }

    .game-over h2 {
      font-size: 24px;
      margin-bottom: 12px;
    }

    @media (max-width: 480px) {
      .card-item {
        width: 60px;
        height: 84px;
        font-size: 12px;
      }
      .card-rank {
        font-size: 16px;
      }
      .card-suit {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <div class="card">
      <div class="header">
        <div class="title-group">
          <div class="title">21ç‚¹</div>
          <div class="subtitle">æŒ‘æˆ˜åº„å®¶ï¼Œæ¥è¿‘21ç‚¹</div>
        </div>
        <div>
          <button id="btnBack" class="btn btn-back">â† è¿”å›</button>
          <button id="btnRestart" class="btn btn-primary">é‡æ–°å¼€å§‹</button>
        </div>
      </div>

      <div class="score-panel">
        <div class="score-box">
          <div class="score-label">ç­¹ç </div>
          <div class="score-value" id="chips">1000</div>
        </div>
        <div class="score-box">
          <div class="score-label">ä¸‹æ³¨</div>
          <div class="score-value" id="bet">0</div>
        </div>
      </div>

      <div class="game-area" style="position: relative;">
        <div class="status-info" id="statusInfo">ç‚¹å‡»"ä¸‹æ³¨"å¼€å§‹æ¸¸æˆ</div>

        <div class="player-area">
          <div class="player-header">
            <div class="player-name">åº„å®¶</div>
            <div class="player-points" id="dealerPoints">0</div>
          </div>
          <div class="cards-container" id="dealerCards"></div>
        </div>

        <div class="player-area">
          <div class="player-header">
            <div class="player-name">ä½ </div>
            <div class="player-points" id="playerPoints">0</div>
          </div>
          <div class="cards-container" id="playerCards"></div>
        </div>

        <div class="action-buttons" id="actionButtons">
          <button class="btn btn-action" id="btnBet100">ä¸‹æ³¨ 100</button>
          <button class="btn btn-action" id="btnBet500">ä¸‹æ³¨ 500</button>
          <button class="btn btn-action green" id="btnHit" disabled>è¦ç‰Œ</button>
          <button class="btn btn-action green" id="btnStand" disabled>åœç‰Œ</button>
        </div>

        <div id="gameOver" class="game-over">
          <h2 id="gameOverTitle">æ¸¸æˆç»“æŸ</h2>
          <p id="gameOverMsg"></p>
          <button id="btnRestartOver" class="btn btn-primary" style="margin-top: 20px;">ç»§ç»­æ¸¸æˆ</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // DOMå…ƒç´ 
      let btnBack, btnRestart, btnRestartOver, btnBet100, btnBet500, btnHit, btnStand;
      let statusInfo, dealerCards, playerCards, dealerPoints, playerPoints, chipsEl, betEl;
      let gameOver, gameOverTitle, gameOverMsg;

      // ç‰Œé¢å®šä¹‰
      const SUITS = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
      const RANKS = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
      const VALUES = {
        'A': [1, 11],
        '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,
        'J': 10, 'Q': 10, 'K': 10
      };

      let deck = [];
      let dealerHand = [];
      let playerHand = [];
      let chips = 1000;
      let currentBet = 0;
      let gameState = 'betting'; // betting, playing, dealerTurn, ended

      function createDeck() {
        const cards = [];
        for (const suit of SUITS) {
          for (const rank of RANKS) {
            cards.push({ suit, rank, isRed: suit === 'â™¥' || suit === 'â™¦' });
          }
        }
        return shuffle(cards);
      }

      function shuffle(array) {
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      function calculatePoints(hand) {
        let points = 0;
        let aces = 0;

        for (const card of hand) {
          if (card.rank === 'A') {
            aces++;
            points += 11;
          } else {
            points += VALUES[card.rank];
          }
        }

        // å¤„ç†Açš„æƒ…å†µ
        while (points > 21 && aces > 0) {
          points -= 10;
          aces--;
        }

        return points;
      }

      function renderCard(container, card, hidden = false) {
        const cardEl = document.createElement('div');
        cardEl.className = `card-item ${card.isRed ? 'red' : 'black'}`;
        if (hidden) {
          cardEl.classList.add('hidden');
        } else {
          cardEl.innerHTML = `
            <div class="card-rank">${card.rank}</div>
            <div class="card-suit">${card.suit}</div>
          `;
        }
        container.appendChild(cardEl);
      }

      function updateDisplay() {
        // æ›´æ–°åº„å®¶æ‰‹ç‰Œ
        dealerCards.innerHTML = '';
        dealerHand.forEach((card, index) => {
          renderCard(dealerCards, card, index === 0 && gameState === 'playing');
        });

        // æ›´æ–°ç©å®¶æ‰‹ç‰Œ
        playerCards.innerHTML = '';
        playerHand.forEach(card => {
          renderCard(playerCards, card);
        });

        // æ›´æ–°ç‚¹æ•°
        if (gameState === 'playing') {
          dealerPoints.textContent = '?';
        } else {
          dealerPoints.textContent = calculatePoints(dealerHand);
        }
        playerPoints.textContent = calculatePoints(playerHand);

        // æ›´æ–°ç­¹ç å’Œä¸‹æ³¨
        chipsEl.textContent = chips;
        betEl.textContent = currentBet;
      }

      function placeBet(amount) {
        console.log("placeBetè¢«è°ƒç”¨", amount, "gameState:", gameState, "chips:", chips);
        if (gameState !== 'betting') {
          console.log("æ¸¸æˆçŠ¶æ€ä¸æ˜¯bettingï¼Œå½“å‰çŠ¶æ€:", gameState);
          return;
        }
        if (chips < amount) {
          console.log("ç­¹ç ä¸è¶³");
          return;
        }
        
        console.log("ä¸‹æ³¨æˆåŠŸ");
        currentBet = amount;
        chips -= amount;
        startGame();
      }

      function startGame() {
        gameState = 'playing';
        deck = createDeck();
        dealerHand = [];
        playerHand = [];

        // å‘ç‰Œ
        playerHand.push(deck.pop());
        dealerHand.push(deck.pop());
        playerHand.push(deck.pop());
        dealerHand.push(deck.pop());

        updateDisplay();
        statusInfo.textContent = "é€‰æ‹©è¦ç‰Œæˆ–åœç‰Œ";
        statusInfo.classList.remove('win', 'lose');
        btnHit.disabled = false;
        btnStand.disabled = false;

        // æ£€æŸ¥é»‘æ°å…‹
        const playerPts = calculatePoints(playerHand);
        const dealerPts = calculatePoints(dealerHand);
        
        if (playerPts === 21 && dealerPts === 21) {
          endGame('tie', "åŒæ–¹éƒ½æ˜¯21ç‚¹ï¼Œå¹³å±€ï¼");
        } else if (playerPts === 21) {
          endGame('win', "é»‘æ°å…‹ï¼ä½ èµ¢äº†ï¼");
        } else if (dealerPts === 21) {
          endGame('lose', "åº„å®¶é»‘æ°å…‹ï¼Œä½ è¾“äº†ï¼");
        }
      }

      function hit() {
        if (gameState !== 'playing') return;

        playerHand.push(deck.pop());
        updateDisplay();

        const points = calculatePoints(playerHand);
        if (points > 21) {
          endGame('lose', "çˆ†ç‰Œäº†ï¼ä½ è¾“äº†ï¼");
        } else if (points === 21) {
          stand();
        }
      }

      function stand() {
        if (gameState !== 'playing') return;

        gameState = 'dealerTurn';
        btnHit.disabled = true;
        btnStand.disabled = true;
        updateDisplay();

        // åº„å®¶è¦ç‰Œ
        setTimeout(() => {
          dealerPlay();
        }, 500);
      }

      function dealerPlay() {
        const playNext = () => {
          let points = calculatePoints(dealerHand);
          
          if (points >= 17) {
            // åº„å®¶åœç‰Œï¼Œæ¯”è¾ƒç‚¹æ•°
            const playerPts = calculatePoints(playerHand);
            const dealerPts = calculatePoints(dealerHand);

            if (playerPts > dealerPts) {
              endGame('win', `ä½ èµ¢äº†ï¼${playerPts} vs ${dealerPts}`);
            } else if (playerPts < dealerPts) {
              endGame('lose', `ä½ è¾“äº†ï¼${playerPts} vs ${dealerPts}`);
            } else {
              endGame('tie', `å¹³å±€ï¼${playerPts} vs ${dealerPts}`);
            }
            return;
          }

          // åº„å®¶è¦ç‰Œ
          dealerHand.push(deck.pop());
          points = calculatePoints(dealerHand);
          updateDisplay();
          
          if (points > 21) {
            endGame('win', "åº„å®¶çˆ†ç‰Œï¼ä½ èµ¢äº†ï¼");
            return;
          }
          
          // å»¶è¿Ÿåç»§ç»­
          setTimeout(playNext, 800);
        };

        playNext();
      }

      function endGame(result, message) {
        gameState = 'ended';
        updateDisplay();
        
        if (result === 'win') {
          chips += currentBet * 2;
          statusInfo.textContent = message;
          statusInfo.classList.add('win');
          gameOverTitle.textContent = "ğŸ‰ ä½ èµ¢äº†ï¼";
        } else if (result === 'lose') {
          statusInfo.textContent = message;
          statusInfo.classList.add('lose');
          gameOverTitle.textContent = "ä½ è¾“äº†";
        } else {
          chips += currentBet;
          statusInfo.textContent = message;
          gameOverTitle.textContent = "å¹³å±€";
        }

        gameOverMsg.textContent = message;
        gameOver.classList.add("show");
        
        btnHit.disabled = true;
        btnStand.disabled = true;

        if (chips <= 0) {
          setTimeout(() => {
            alert("ç­¹ç ç”¨å®Œäº†ï¼æ¸¸æˆç»“æŸï¼");
            restart();
          }, 2000);
        }
      }

      function restart() {
        gameOver.classList.remove("show");
        gameState = 'betting';
        currentBet = 0;
        dealerHand = [];
        playerHand = [];
        statusInfo.textContent = "ç‚¹å‡»\"ä¸‹æ³¨\"å¼€å§‹æ¸¸æˆ";
        statusInfo.classList.remove('win', 'lose');
        btnHit.disabled = true;
        btnStand.disabled = true;
        updateDisplay();
      }

      function newGame() {
        if (chips <= 0) {
          chips = 1000; // é‡ç½®ç­¹ç 
        }
        restart();
      }

      // åˆå§‹åŒ–å‡½æ•°
      function init() {
        // è·å–DOMå…ƒç´ 
        btnBack = document.getElementById("btnBack");
        btnRestart = document.getElementById("btnRestart");
        btnRestartOver = document.getElementById("btnRestartOver");
        btnBet100 = document.getElementById("btnBet100");
        btnBet500 = document.getElementById("btnBet500");
        btnHit = document.getElementById("btnHit");
        btnStand = document.getElementById("btnStand");
        statusInfo = document.getElementById("statusInfo");
        dealerCards = document.getElementById("dealerCards");
        playerCards = document.getElementById("playerCards");
        dealerPoints = document.getElementById("dealerPoints");
        playerPoints = document.getElementById("playerPoints");
        chipsEl = document.getElementById("chips");
        betEl = document.getElementById("bet");
        gameOver = document.getElementById("gameOver");
        gameOverTitle = document.getElementById("gameOverTitle");
        gameOverMsg = document.getElementById("gameOverMsg");

        // ç»‘å®šäº‹ä»¶
        if (btnBack) btnBack.addEventListener("click", () => {
          window.location.href = "index.html";
        });
        if (btnBet100) btnBet100.addEventListener("click", () => {
          console.log("ä¸‹æ³¨100è¢«ç‚¹å‡»");
          placeBet(100);
        });
        if (btnBet500) btnBet500.addEventListener("click", () => {
          console.log("ä¸‹æ³¨500è¢«ç‚¹å‡»");
          placeBet(500);
        });
        if (btnHit) btnHit.addEventListener("click", hit);
        if (btnStand) btnStand.addEventListener("click", stand);
        if (btnRestart) btnRestart.addEventListener("click", newGame);
        if (btnRestartOver) btnRestartOver.addEventListener("click", restart);
        
        // ç¡®ä¿åˆå§‹çŠ¶æ€æ­£ç¡®
        gameState = 'betting';
        currentBet = 0;
        dealerHand = [];
        playerHand = [];
        chips = 1000;
        
        updateDisplay();
      }

      // ç­‰å¾…DOMåŠ è½½å®Œæˆåå†åˆå§‹åŒ–
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        // DOMå·²ç»åŠ è½½å®Œæˆï¼Œç«‹å³åˆå§‹åŒ–
        setTimeout(init, 0);
      }
    })();
  </script>
</body>
</html>

