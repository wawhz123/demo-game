<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>2048 - Ê∏∏ÊàèÂ§ßÂéÖ</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      background: radial-gradient(circle at top, #e0f2fe 0, #bfdbfe 35%, #93c5fd 70%, #60a5fa 100%);
      color: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 16px;
    }

    .game-wrapper {
      width: 100%;
      max-width: 500px;
    }

    .card {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      padding: 16px;
      box-shadow:
        0 18px 45px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(148, 163, 184, 0.18);
      backdrop-filter: blur(12px);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .title-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: 0.02em;
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn {
      appearance: none;
      border: none;
      outline: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.02em;
      cursor: pointer;
      transition: all 0.16s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #06b6d4);
      color: #f9fafb;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.45);
    }

    .btn-primary:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 6px 14px rgba(37, 99, 235, 0.45);
    }

    .btn-back {
      background: rgba(15, 23, 42, 0.8);
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 6px 10px;
    }

    .btn-back:active {
      transform: translateY(1px);
      background: rgba(15, 23, 42, 1);
    }

    .score-panel {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .score-box {
      flex: 1;
      background: rgba(15, 23, 42, 0.8);
      border-radius: 12px;
      padding: 12px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      text-align: center;
    }

    .score-label {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .score-value {
      font-size: 24px;
      font-weight: 700;
      color: #fbbf24;
    }

    .game-board {
      background: rgba(15, 23, 42, 0.5);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 12px;
      position: relative;
    }

    .grid-container {
      position: relative;
      width: 100%;
      padding-top: 100%;
    }

    .grid {
      position: absolute;
      inset: 0;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 8px;
      background: rgba(30, 41, 59, 0.8);
      border-radius: 8px;
      padding: 8px;
    }

    .cell {
      background: rgba(51, 65, 85, 0.6);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 700;
      color: #f9fafb;
      transition: all 0.15s ease;
    }

    .cell.tile {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      animation: appear 0.2s ease;
    }

    .cell.tile-2 { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #78350f; }
    .cell.tile-4 { background: linear-gradient(135deg, #fed7aa, #fdba74); color: #78350f; }
    .cell.tile-8 { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #78350f; }
    .cell.tile-16 { background: linear-gradient(135deg, #fcd34d, #fbbf24); color: #78350f; }
    .cell.tile-32 { background: linear-gradient(135deg, #facc15, #eab308); color: #78350f; }
    .cell.tile-64 { background: linear-gradient(135deg, #eab308, #ca8a04); color: #78350f; }
    .cell.tile-128 { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #78350f; font-size: 20px; }
    .cell.tile-256 { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #78350f; font-size: 20px; }
    .cell.tile-512 { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #78350f; font-size: 20px; }
    .cell.tile-1024 { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #78350f; font-size: 18px; }
    .cell.tile-2048 { 
      background: linear-gradient(135deg, #fbbf24, #f59e0b); 
      color: #78350f; 
      font-size: 18px;
      box-shadow: 0 0 20px rgba(251, 191, 36, 0.6);
      animation: pulse 1s infinite;
    }

    @keyframes appear {
      from {
        transform: scale(0);
      }
      to {
        transform: scale(1);
      }
    }

    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.6);
      }
      50% {
        box-shadow: 0 0 30px rgba(251, 191, 36, 0.9);
      }
    }

    .game-over {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 12px;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .game-over.show {
      display: flex;
    }

    .game-over.win {
      background: rgba(15, 23, 42, 0.98);
    }

    .game-over.win h2 {
      color: #fbbf24;
      text-shadow: 0 0 20px rgba(251, 191, 36, 0.6);
    }

    .game-over h2 {
      font-size: 24px;
      margin-bottom: 12px;
      color: #f9fafb;
    }

    .game-over p {
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 20px;
    }

    .controls-hint {
      font-size: 11px;
      color: #9ca3af;
      text-align: center;
      line-height: 1.5;
    }

    @media (max-width: 480px) {
      .title {
        font-size: 20px;
      }
      .cell {
        font-size: 18px;
      }
      .cell.tile-128,
      .cell.tile-256,
      .cell.tile-512 {
        font-size: 16px;
      }
      .cell.tile-1024,
      .cell.tile-2048 {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <div class="card">
      <div class="header">
        <div class="title-group">
          <div class="title">2048</div>
          <div class="subtitle">ÂêàÂπ∂Êï∞Â≠óÔºåËææÂà∞2048ÔºÅ</div>
        </div>
        <div class="controls">
          <button id="btnBack" class="btn btn-back">‚Üê ËøîÂõû</button>
          <button id="btnRestart" class="btn btn-primary">ÈáçÊñ∞ÂºÄÂßã</button>
        </div>
      </div>

      <div class="score-panel">
        <div class="score-box">
          <div class="score-label">ÂæóÂàÜ</div>
          <div class="score-value" id="score">0</div>
        </div>
        <div class="score-box">
          <div class="score-label">ÊúÄÈ´òÂàÜ</div>
          <div class="score-value" id="bestScore">0</div>
        </div>
      </div>

      <div class="game-board">
        <div class="grid-container">
          <div class="grid" id="grid"></div>
        </div>
        <div id="gameOver" class="game-over">
          <h2 id="gameOverTitle">Ê∏∏ÊàèÁªìÊùü</h2>
          <p id="finalScore">ÂæóÂàÜ: 0</p>
          <button id="btnRestartOver" class="btn btn-primary">ÈáçÊñ∞ÂºÄÂßã</button>
        </div>
      </div>

      <div class="controls-hint">
        ‰ΩøÁî®ÊñπÂêëÈîÆÊàñÊªëÂä®Êù•ÁßªÂä®ÊñπÂùóÔºåÁõ∏ÂêåÊï∞Â≠ó‰ºöÂêàÂπ∂
      </div>
    </div>
  </div>

  <script>
    (function () {
      const grid = document.getElementById("grid");
      const scoreEl = document.getElementById("score");
      const bestScoreEl = document.getElementById("bestScore");
      const gameOver = document.getElementById("gameOver");
      const gameOverTitle = document.getElementById("gameOverTitle");
      const finalScore = document.getElementById("finalScore");
      const btnBack = document.getElementById("btnBack");
      const btnRestart = document.getElementById("btnRestart");
      const btnRestartOver = document.getElementById("btnRestartOver");

      let isWon = false;

      btnBack.addEventListener("click", () => {
        window.location.href = "index.html";
      });

      const SIZE = 4;
      let board = [];
      let score = 0;
      let bestScore = parseInt(localStorage.getItem("2048-best") || "0", 10);

      function initBoard() {
        board = Array(SIZE).fill().map(() => Array(SIZE).fill(0));
        addRandomTile();
        addRandomTile();
        render();
      }

      function addRandomTile() {
        const emptyCells = [];
        for (let y = 0; y < SIZE; y++) {
          for (let x = 0; x < SIZE; x++) {
            if (board[y][x] === 0) {
              emptyCells.push({ x, y });
            }
          }
        }
        if (emptyCells.length > 0) {
          const cell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
          board[cell.y][cell.x] = Math.random() < 0.9 ? 2 : 4;
        }
      }

      function moveLeft() {
        let moved = false;
        for (let y = 0; y < SIZE; y++) {
          const row = board[y].filter(val => val !== 0);
          const newRow = [];
          for (let i = 0; i < row.length; i++) {
            if (i < row.length - 1 && row[i] === row[i + 1]) {
              newRow.push(row[i] * 2);
              score += row[i] * 2;
              i++;
              moved = true;
            } else {
              newRow.push(row[i]);
              if (row[i] !== board[y][i]) moved = true;
            }
          }
          while (newRow.length < SIZE) {
            newRow.push(0);
          }
          board[y] = newRow;
        }
        return moved;
      }

      function moveRight() {
        let moved = false;
        for (let y = 0; y < SIZE; y++) {
          const row = board[y].filter(val => val !== 0);
          const newRow = [];
          for (let i = row.length - 1; i >= 0; i--) {
            if (i > 0 && row[i] === row[i - 1]) {
              newRow.unshift(row[i] * 2);
              score += row[i] * 2;
              i--;
              moved = true;
            } else {
              newRow.unshift(row[i]);
              if (row[i] !== board[y][SIZE - newRow.length]) moved = true;
            }
          }
          while (newRow.length < SIZE) {
            newRow.unshift(0);
          }
          board[y] = newRow;
        }
        return moved;
      }

      function moveUp() {
        let moved = false;
        for (let x = 0; x < SIZE; x++) {
          const col = [];
          for (let y = 0; y < SIZE; y++) {
            if (board[y][x] !== 0) {
              col.push(board[y][x]);
            }
          }
          const newCol = [];
          for (let i = 0; i < col.length; i++) {
            if (i < col.length - 1 && col[i] === col[i + 1]) {
              newCol.push(col[i] * 2);
              score += col[i] * 2;
              i++;
              moved = true;
            } else {
              newCol.push(col[i]);
              if (col[i] !== board[newCol.length - 1][x]) moved = true;
            }
          }
          while (newCol.length < SIZE) {
            newCol.push(0);
          }
          for (let y = 0; y < SIZE; y++) {
            board[y][x] = newCol[y];
          }
        }
        return moved;
      }

      function moveDown() {
        let moved = false;
        for (let x = 0; x < SIZE; x++) {
          const col = [];
          for (let y = 0; y < SIZE; y++) {
            if (board[y][x] !== 0) {
              col.push(board[y][x]);
            }
          }
          const newCol = [];
          for (let i = col.length - 1; i >= 0; i--) {
            if (i > 0 && col[i] === col[i - 1]) {
              newCol.unshift(col[i] * 2);
              score += col[i] * 2;
              i--;
              moved = true;
            } else {
              newCol.unshift(col[i]);
              if (col[i] !== board[SIZE - newCol.length][x]) moved = true;
            }
          }
          while (newCol.length < SIZE) {
            newCol.unshift(0);
          }
          for (let y = 0; y < SIZE; y++) {
            board[y][x] = newCol[y];
          }
        }
        return moved;
      }

      function canMove() {
        for (let y = 0; y < SIZE; y++) {
          for (let x = 0; x < SIZE; x++) {
            if (board[y][x] === 0) return true;
            if (x < SIZE - 1 && board[y][x] === board[y][x + 1]) return true;
            if (y < SIZE - 1 && board[y][x] === board[y + 1][x]) return true;
          }
        }
        return false;
      }

      function checkWin() {
        for (let y = 0; y < SIZE; y++) {
          for (let x = 0; x < SIZE; x++) {
            if (board[y][x] === 2048) {
              return true;
            }
          }
        }
        return false;
      }

      function render() {
        grid.innerHTML = "";
        for (let y = 0; y < SIZE; y++) {
          for (let x = 0; x < SIZE; x++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            if (board[y][x] !== 0) {
              cell.className += ` tile tile-${board[y][x]}`;
              cell.textContent = board[y][x];
            }
            grid.appendChild(cell);
          }
        }
        scoreEl.textContent = score;
        if (score > bestScore) {
          bestScore = score;
          bestScoreEl.textContent = bestScore;
          localStorage.setItem("2048-best", bestScore.toString());
        } else {
          bestScoreEl.textContent = bestScore;
        }
      }

      function handleMove(direction) {
        // Â¶ÇÊûúÂ∑≤ÁªèËé∑ËÉúÔºå‰∏çÂÖÅËÆ∏ÁªßÁª≠ÁßªÂä®
        if (isWon) {
          return;
        }

        if (!canMove()) {
          gameOver.classList.add("show");
          gameOverTitle.textContent = "Ê∏∏ÊàèÁªìÊùü";
          gameOver.classList.remove("win");
          finalScore.textContent = `ÂæóÂàÜ: ${score}`;
          return;
        }

        let moved = false;
        switch (direction) {
          case "left":
            moved = moveLeft();
            break;
          case "right":
            moved = moveRight();
            break;
          case "up":
            moved = moveUp();
            break;
          case "down":
            moved = moveDown();
            break;
        }

        if (moved) {
          addRandomTile();
          render();
          
          // Ê£ÄÊü•ÊòØÂê¶ËææÂà∞2048
          if (!isWon && checkWin()) {
            isWon = true;
            setTimeout(() => {
              gameOver.classList.add("show", "win");
              gameOverTitle.textContent = "üéâ ÊÅ≠ÂñúËÉúÂà©ÔºÅ";
              finalScore.textContent = `ÂæóÂàÜ: ${score}`;
            }, 300);
            return;
          }
          
          // Ê£ÄÊü•ÊòØÂê¶Êó†Ê≥ïÁªßÁª≠ÁßªÂä®
          if (!canMove()) {
            setTimeout(() => {
              gameOver.classList.add("show");
              gameOverTitle.textContent = "Ê∏∏ÊàèÁªìÊùü";
              gameOver.classList.remove("win");
              finalScore.textContent = `ÂæóÂàÜ: ${score}`;
            }, 300);
          }
        }
      }

      let touchStartX = 0;
      let touchStartY = 0;

      window.addEventListener("keydown", (e) => {
        if (gameOver.classList.contains("show") || isWon) return;
        switch (e.key) {
          case "ArrowLeft":
            e.preventDefault();
            handleMove("left");
            break;
          case "ArrowRight":
            e.preventDefault();
            handleMove("right");
            break;
          case "ArrowUp":
            e.preventDefault();
            handleMove("up");
            break;
          case "ArrowDown":
            e.preventDefault();
            handleMove("down");
            break;
        }
      });

      grid.addEventListener("touchstart", (e) => {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
      }, { passive: true });

      grid.addEventListener("touchend", (e) => {
        if (gameOver.classList.contains("show") || isWon) return;
        const touchEndX = e.changedTouches[0].clientX;
        const touchEndY = e.changedTouches[0].clientY;
        const dx = touchEndX - touchStartX;
        const dy = touchEndY - touchStartY;
        const minSwipe = 30;

        if (Math.abs(dx) > Math.abs(dy)) {
          if (dx > minSwipe) {
            handleMove("right");
          } else if (dx < -minSwipe) {
            handleMove("left");
          }
        } else {
          if (dy > minSwipe) {
            handleMove("down");
          } else if (dy < -minSwipe) {
            handleMove("up");
          }
        }
      }, { passive: true });

      function restart() {
        board = [];
        score = 0;
        isWon = false;
        gameOver.classList.remove("show", "win");
        gameOverTitle.textContent = "Ê∏∏ÊàèÁªìÊùü";
        initBoard();
      }

      btnRestart.addEventListener("click", restart);
      btnRestartOver.addEventListener("click", restart);

      // ÂàùÂßãÂåñ
      initBoard();
    })();
  </script>
</body>
</html>

