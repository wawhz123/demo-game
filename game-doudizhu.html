<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>æ–—åœ°ä¸» - æ¸¸æˆå¤§å…</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      background: radial-gradient(circle at top, #e0f2fe 0, #bfdbfe 35%, #93c5fd 70%, #60a5fa 100%);
      color: #f9fafb;
      min-height: 100vh;
      padding: 16px;
    }

    .game-wrapper {
      max-width: 800px;
      margin: 0 auto;
    }

    .card {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      padding: 16px;
      box-shadow:
        0 18px 45px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(148, 163, 184, 0.18);
      backdrop-filter: blur(12px);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .title-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title {
      font-size: 20px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    .btn {
      appearance: none;
      border: none;
      outline: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.16s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #06b6d4);
      color: #f9fafb;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.45);
    }

    .btn-primary:active {
      transform: translateY(1px) scale(0.99);
    }

    .btn-back {
      background: rgba(15, 23, 42, 0.8);
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 6px 10px;
    }

    .btn-action {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: #f9fafb;
      padding: 10px 20px;
      font-size: 14px;
      margin: 4px;
    }

    .btn-action:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .game-area {
      position: relative;
      min-height: 500px;
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(59, 130, 246, 0.1));
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .players {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .player {
      flex: 1;
      text-align: center;
      padding: 12px;
      background: rgba(15, 23, 42, 0.6);
      border-radius: 8px;
      border: 2px solid transparent;
    }

    .player.active {
      border-color: #fbbf24;
      box-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
    }

    .player.landlord {
      border-color: #f59e0b;
    }

    .player-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .player-cards-count {
      font-size: 12px;
      color: #9ca3af;
    }

    .center-area {
      text-align: center;
      margin: 20px 0;
      min-height: 100px;
    }

    .played-cards {
      display: flex;
      justify-content: center;
      gap: 4px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .card-item {
      width: 40px;
      height: 56px;
      background: linear-gradient(135deg, #f9fafb, #e5e7eb);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      color: #1f2937;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .card-item.red {
      color: #dc2626;
    }

    .card-item.black {
      color: #1f2937;
    }

    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 12px;
    }

    .my-cards {
      display: flex;
      justify-content: center;
      gap: 4px;
      flex-wrap: wrap;
      margin-top: 20px;
      padding: 12px;
      background: rgba(15, 23, 42, 0.6);
      border-radius: 8px;
    }

    .my-card {
      width: 50px;
      height: 70px;
      background: linear-gradient(135deg, #f9fafb, #e5e7eb);
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      color: #1f2937;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      border: 2px solid transparent;
    }

    .my-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .my-card.selected {
      border-color: #fbbf24;
      transform: translateY(-8px);
      background: linear-gradient(135deg, #fef3c7, #fde68a);
    }

    .my-card.red {
      color: #dc2626;
    }

    .my-card.black {
      color: #1f2937;
    }

    .status-info {
      text-align: center;
      padding: 12px;
      background: rgba(15, 23, 42, 0.8);
      border-radius: 8px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .game-over {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.98);
      border-radius: 12px;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .game-over.show {
      display: flex;
    }

    .game-over h2 {
      font-size: 24px;
      margin-bottom: 12px;
    }

    @media (max-width: 768px) {
      .my-card {
        width: 40px;
        height: 56px;
        font-size: 12px;
      }
      .card-item {
        width: 30px;
        height: 42px;
        font-size: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <div class="card">
      <div class="header">
        <div class="title-group">
          <div class="title">æ–—åœ°ä¸»</div>
          <div class="subtitle">ä¸‰äººå¯¹æˆ˜ï¼Œä½“éªŒç»å…¸å¡ç‰Œæ¸¸æˆ</div>
        </div>
        <div>
          <button id="btnBack" class="btn btn-back">â† è¿”å›</button>
          <button id="btnRestart" class="btn btn-primary">é‡æ–°å¼€å§‹</button>
        </div>
      </div>

      <div class="game-area">
        <div class="status-info" id="statusInfo">ç­‰å¾…å¼€å§‹æ¸¸æˆ...</div>

        <div class="players">
          <div class="player" id="player1">
            <div class="player-name">ç©å®¶1 (AI)</div>
            <div class="player-cards-count" id="count1">17å¼ </div>
          </div>
          <div class="player" id="player2">
            <div class="player-name">ç©å®¶2 (AI)</div>
            <div class="player-cards-count" id="count2">17å¼ </div>
          </div>
          <div class="player" id="player0">
            <div class="player-name">ä½ </div>
            <div class="player-cards-count" id="count0">20å¼ </div>
          </div>
        </div>

        <div class="center-area">
          <div class="played-cards" id="playedCards"></div>
          <div class="action-buttons" id="actionButtons"></div>
        </div>

        <div class="my-cards" id="myCards"></div>

        <div id="gameOver" class="game-over">
          <h2 id="gameOverTitle">æ¸¸æˆç»“æŸ</h2>
          <p id="gameOverMsg"></p>
          <button id="btnRestartOver" class="btn btn-primary" style="margin-top: 20px;">é‡æ–°å¼€å§‹</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const btnBack = document.getElementById("btnBack");
      const btnRestart = document.getElementById("btnRestart");
      const btnRestartOver = document.getElementById("btnRestartOver");
      const statusInfo = document.getElementById("statusInfo");
      const myCards = document.getElementById("myCards");
      const playedCards = document.getElementById("playedCards");
      const actionButtons = document.getElementById("actionButtons");
      const gameOver = document.getElementById("gameOver");
      const gameOverTitle = document.getElementById("gameOverTitle");
      const gameOverMsg = document.getElementById("gameOverMsg");

      btnBack.addEventListener("click", () => {
        window.location.href = "index.html";
      });

      // ç‰Œé¢å®šä¹‰
      const SUITS = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
      const RANKS = ['3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A', '2'];
      const JOKERS = ['å°ç‹', 'å¤§ç‹'];

      // ç‰Œå€¼ï¼ˆç”¨äºæ¯”è¾ƒå¤§å°ï¼‰
      const CARD_VALUES = {
        '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,
        'J': 11, 'Q': 12, 'K': 13, 'A': 14, '2': 15,
        'å°ç‹': 16, 'å¤§ç‹': 17
      };

      let deck = [];
      let players = [[], [], []]; // 0: ç©å®¶, 1: AI1, 2: AI2
      let bottomCards = [];
      let landlord = -1;
      let currentPlayer = 0;
      let lastPlayed = null;
      let selectedCards = [];
      let gamePhase = 'bidding'; // bidding, playing, ended

      function createDeck() {
        const cards = [];
        // æ™®é€šç‰Œ
        for (const suit of SUITS) {
          for (const rank of RANKS) {
            cards.push({ suit, rank, value: CARD_VALUES[rank], isRed: suit === 'â™¥' || suit === 'â™¦' });
          }
        }
        // å¤§å°ç‹
        cards.push({ suit: '', rank: 'å°ç‹', value: CARD_VALUES['å°ç‹'], isRed: false });
        cards.push({ suit: '', rank: 'å¤§ç‹', value: CARD_VALUES['å¤§ç‹'], isRed: true });
        return shuffle(cards);
      }

      function shuffle(array) {
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      function dealCards() {
        deck = createDeck();
        players = [[], [], []];
        for (let i = 0; i < 51; i++) {
          players[i % 3].push(deck[i]);
        }
        // å‰©ä½™3å¼ ä½œä¸ºåº•ç‰Œ
        bottomCards = deck.slice(51);
        // æ’åº
        players.forEach(hand => hand.sort((a, b) => a.value - b.value));
      }

      function initGame() {
        gamePhase = 'bidding';
        landlord = -1;
        currentPlayer = Math.floor(Math.random() * 3);
        selectedCards = [];
        lastPlayed = null;
        bottomCards = [];
        dealCards();
        updateDisplay();
        statusInfo.textContent = `ç©å®¶${currentPlayer + 1}å¼€å§‹å«åœ°ä¸»...`;
        
        // AIè‡ªåŠ¨å«åœ°ä¸»
        setTimeout(() => {
          handleBidding();
        }, 1000);
      }

      function handleBidding() {
        if (gamePhase !== 'bidding') return;
        
        if (currentPlayer === 0) {
          // ç©å®¶å«åœ°ä¸»
          showBiddingButtons();
        } else {
          // AIå«åœ°ä¸»ï¼ˆç®€å•é€»è¾‘ï¼šéšæœºå†³å®šï¼‰
          setTimeout(() => {
            const willBid = Math.random() < 0.3;
            if (willBid || landlord === -1) {
              landlord = currentPlayer;
              statusInfo.textContent = `ç©å®¶${currentPlayer + 1}æˆä¸ºåœ°ä¸»ï¼`;
              players[currentPlayer].push(...bottomCards);
              players[currentPlayer].sort((a, b) => a.value - b.value);
              gamePhase = 'playing';
              currentPlayer = landlord;
              updateDisplay();
              setTimeout(() => {
                if (currentPlayer === 0) {
                  statusInfo.textContent = "è½®åˆ°ä½ å‡ºç‰Œ";
                } else {
                  playAI();
                }
              }, 1000);
            } else {
              nextPlayer();
            }
          }, 800);
        }
      }

      function showBiddingButtons() {
        actionButtons.innerHTML = `
          <button class="btn btn-action" id="btnBidLandlord">å«åœ°ä¸»</button>
          <button class="btn btn-action" id="btnPassBidding">ä¸å«</button>
        `;
        document.getElementById("btnBidLandlord").addEventListener("click", bidLandlord);
        document.getElementById("btnPassBidding").addEventListener("click", passBidding);
      }

      function bidLandlord() {
        if (gamePhase !== 'bidding' || currentPlayer !== 0) return;
        landlord = 0;
        players[0].push(...bottomCards);
        players[0].sort((a, b) => a.value - b.value);
        gamePhase = 'playing';
        currentPlayer = 0;
        actionButtons.innerHTML = '';
        updateDisplay();
        statusInfo.textContent = "ä½ æˆä¸ºåœ°ä¸»ï¼è½®åˆ°ä½ å‡ºç‰Œ";
      }

      function passBidding() {
        if (gamePhase !== 'bidding' || currentPlayer !== 0) return;
        actionButtons.innerHTML = '';
        nextPlayer();
      }

      function nextPlayer() {
        currentPlayer = (currentPlayer + 1) % 3;
        if (gamePhase === 'bidding') {
          if (landlord === -1 && currentPlayer === 0) {
            // å¦‚æœéƒ½æ²¡å«ï¼Œéšæœºé€‰ä¸€ä¸ª
            landlord = Math.floor(Math.random() * 3);
            players[landlord].push(...bottomCards);
            players[landlord].sort((a, b) => a.value - b.value);
            gamePhase = 'playing';
            currentPlayer = landlord;
            statusInfo.textContent = `ç©å®¶${landlord + 1}æˆä¸ºåœ°ä¸»ï¼`;
            updateDisplay();
            setTimeout(() => {
              if (currentPlayer === 0) {
                statusInfo.textContent = "è½®åˆ°ä½ å‡ºç‰Œ";
              } else {
                playAI();
              }
            }, 1000);
          } else {
            handleBidding();
          }
        } else {
          updateDisplay();
          setTimeout(() => {
            if (currentPlayer === 0) {
              statusInfo.textContent = "è½®åˆ°ä½ å‡ºç‰Œ";
            } else {
              playAI();
            }
          }, 1000);
        }
      }

      function playAI() {
        if (currentPlayer === 0 || gamePhase !== 'playing') return;
        
        setTimeout(() => {
          const play = getAIPlay();
          if (play) {
            playCards(currentPlayer, play);
          } else {
            statusInfo.textContent = `ç©å®¶${currentPlayer + 1}è¦ä¸èµ·`;
            setTimeout(() => {
              lastPlayed = null;
              nextPlayer();
            }, 1000);
          }
        }, 1000);
      }

      function getAIPlay() {
        const hand = players[currentPlayer];
        if (!lastPlayed) {
          // å‡ºå•å¼ æœ€å°çš„
          return [hand[0]];
        }
        // ç®€å•AIï¼šå°è¯•å‡ºèƒ½å‹è¿‡çš„ç‰Œ
        const lastType = getCardType(lastPlayed);
        if (lastType === 'single') {
          const lastValue = lastPlayed[0].value;
          const playable = hand.find(c => c.value > lastValue);
          return playable ? [playable] : null;
        }
        // å…¶ä»–æƒ…å†µæš‚æ—¶è·³è¿‡
        return null;
      }

      function getCardType(cards) {
        if (!cards || cards.length === 0) return null;
        if (cards.length === 1) return 'single';
        if (cards.length === 2) {
          if (cards[0].value === cards[1].value) return 'pair';
        }
        if (cards.length === 3) {
          if (cards[0].value === cards[1].value && cards[1].value === cards[2].value) return 'triple';
        }
        // ç®€åŒ–å¤„ç†ï¼Œæ›´å¤šç‰Œå‹å¯ä»¥åç»­æ‰©å±•
        return 'unknown';
      }

      function canPlay(selected, last) {
        if (!selected || selected.length === 0) return false;
        if (!last) return true;
        
        const selectedType = getCardType(selected);
        const lastType = getCardType(last);
        
        if (selectedType !== lastType) return false;
        
        if (selectedType === 'single') {
          return selected[0].value > last[0].value;
        }
        if (selectedType === 'pair') {
          return selected[0].value > last[0].value;
        }
        // ç®€åŒ–å¤„ç†
        return true;
      }

      function playCards(playerIndex, cards) {
        const hand = players[playerIndex];
        cards.forEach(card => {
          const index = hand.findIndex(c => 
            c.suit === card.suit && c.rank === card.rank && c.value === card.value
          );
          if (index !== -1) {
            hand.splice(index, 1);
          }
        });
        
        lastPlayed = cards;
        updateDisplay();
        
        // æ£€æŸ¥æ˜¯å¦è·èƒœ
        if (hand.length === 0) {
          endGame(playerIndex);
          return;
        }
        
        nextPlayer();
      }

      function endGame(winner) {
        gamePhase = 'ended';
        const isLandlordWin = (winner === landlord);
        const isPlayerWin = (winner === 0);
        
        if (isPlayerWin) {
          gameOverTitle.textContent = isLandlordWin ? "ğŸ‰ åœ°ä¸»èƒœåˆ©ï¼" : "ğŸ‰ å†œæ°‘èƒœåˆ©ï¼";
        } else {
          gameOverTitle.textContent = isLandlordWin ? "åœ°ä¸»èƒœåˆ©" : "å†œæ°‘èƒœåˆ©";
        }
        gameOverMsg.textContent = `ç©å®¶${winner + 1}è·èƒœï¼`;
        gameOver.classList.add("show");
      }

      function updateDisplay() {
        // æ›´æ–°ç©å®¶ä¿¡æ¯
        for (let i = 0; i < 3; i++) {
          const playerEl = document.getElementById(`player${i}`);
          const countEl = document.getElementById(`count${i}`);
          playerEl.classList.remove('active', 'landlord');
          if (i === currentPlayer) playerEl.classList.add('active');
          if (i === landlord) playerEl.classList.add('landlord');
          countEl.textContent = `${players[i].length}å¼ `;
        }

        // æ›´æ–°ç©å®¶æ‰‹ç‰Œ
        myCards.innerHTML = '';
        players[0].forEach((card, index) => {
          const cardEl = document.createElement('div');
          cardEl.className = `my-card ${card.isRed ? 'red' : 'black'}`;
          cardEl.textContent = card.suit + card.rank;
          cardEl.onclick = () => {
            if (gamePhase !== 'playing' || currentPlayer !== 0) return;
            const cardIndex = selectedCards.findIndex(c => 
              c.suit === card.suit && c.rank === card.rank
            );
            if (cardIndex === -1) {
              selectedCards.push(card);
            } else {
              selectedCards.splice(cardIndex, 1);
            }
            updateMyCards();
          };
          myCards.appendChild(cardEl);
        });
        updateMyCards();

        // æ›´æ–°å·²å‡ºçš„ç‰Œ
        playedCards.innerHTML = '';
        if (lastPlayed) {
          lastPlayed.forEach(card => {
            const cardEl = document.createElement('div');
            cardEl.className = `card-item ${card.isRed ? 'red' : 'black'}`;
            cardEl.textContent = card.suit + card.rank;
            playedCards.appendChild(cardEl);
          });
        }

        // æ›´æ–°æ“ä½œæŒ‰é’®
        if (currentPlayer === 0 && gamePhase === 'playing') {
          actionButtons.innerHTML = `
            <button class="btn btn-action" id="btnPlaySelected" ${selectedCards.length === 0 ? 'disabled' : ''}>å‡ºç‰Œ</button>
            <button class="btn btn-action" id="btnPassTurn">è¦ä¸èµ·</button>
          `;
          const btnPlay = document.getElementById("btnPlaySelected");
          const btnPass = document.getElementById("btnPassTurn");
          if (btnPlay) btnPlay.addEventListener("click", playSelected);
          if (btnPass) btnPass.addEventListener("click", passTurn);
        }
      }

      function updateMyCards() {
        const cardElements = myCards.querySelectorAll('.my-card');
        players[0].forEach((card, index) => {
          const cardEl = cardElements[index];
          const isSelected = selectedCards.some(c => 
            c.suit === card.suit && c.rank === card.rank
          );
          if (isSelected) {
            cardEl.classList.add('selected');
          } else {
            cardEl.classList.remove('selected');
          }
        });
      }

      function playSelected() {
        if (currentPlayer !== 0 || selectedCards.length === 0) return;
        if (!canPlay(selectedCards, lastPlayed)) {
          statusInfo.textContent = "ä¸èƒ½å‡ºè¿™äº›ç‰Œï¼Œè¯·é‡æ–°é€‰æ‹©";
          return;
        }
        const cardsToPlay = [...selectedCards];
        selectedCards = [];
        playCards(0, cardsToPlay);
      }

      function passTurn() {
        if (currentPlayer !== 0) return;
        statusInfo.textContent = "ä½ è¦ä¸èµ·";
        setTimeout(() => {
          lastPlayed = null;
          nextPlayer();
        }, 500);
      }

      function restart() {
        gameOver.classList.remove("show");
        initGame();
      }

      btnRestart.addEventListener("click", restart);
      btnRestartOver.addEventListener("click", restart);

      // åˆå§‹åŒ–
      initGame();
    })();
  </script>
</body>
</html>

